; ************************************************************************************************
; ************************************************************************************************
;
;		Name:		buffer.asm
;		Purpose:	Buffer for String I/O
;		Created:	25th May 2023
;		Reviewed: 	25th June 2023
;		Author:		Paul Robson (paul@robsons.org.uk)
;
; ************************************************************************************************
; ************************************************************************************************

		.section code

; ************************************************************************************************
;
;								Reset / Empty the buffer
;
; ************************************************************************************************

IFloatBufferReset:
		stz 	IFBufferCount
		stz 	IFBuffer
		rts

; ************************************************************************************************
;
;								Get buffer address to YX length A
;
; ************************************************************************************************

IFloatGetBufferAddress:
		ldy 	#(IFBuffer >> 8)
		ldx 	#(IFBuffer & $FF)
		lda 	IFBufferCount
		rts

; ************************************************************************************************
;
;								Write character to buffer
;
; ************************************************************************************************

IFloatBufferWrite:
		phx
		ldx 	IFBufferCount
		sta 	IFBuffer,x
		stz 	IFBuffer+1,x
		inc 	IFBufferCount
		plx
		rts

; ************************************************************************************************
;
;								Strip any trailing zeros
;
; ************************************************************************************************

IFloatStripTrailingZeros:
		ldx 	IFBufferCount
		lda 	IFBuffer-1,x
		cmp		#"0"
		bne 	_IFSTExit
		lda 	IFBuffer-2,x
		cmp 	#"."
		beq 	_IFSTExit
		dec 	IFBufferCount
		stz 	IFBuffer-1,x
		bra 	IFloatStripTrailingZeros
_IFSTExit:
		rts		

		.send code

		.section storage
IFBufferCount:
		.fill 	1
IFBuffer:
		.fill 	25						
		.send 	storage

; ************************************************************************************************
;
;									Changes and Updates
;
; ************************************************************************************************
;
;		Date			Notes
;		==== 			=====
;
; ************************************************************************************************

